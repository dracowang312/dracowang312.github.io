<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"draco.wang","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":"truw","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="SQL Server 是微软公司开发的关系型数据库管理系统（RDBMS），用于存储和管理数据。它提供了一种可靠的、安全的和高效的方式来管理大型数据集合，并提供了许多功能和工具，使开发人员能够轻松地创建和管理数据库应用程序。">
<meta property="og:type" content="article">
<meta property="og:title" content="SQLServer">
<meta property="og:url" content="https://draco.wang/SQLServer/index.html">
<meta property="og:site_name" content="王小龙的博客">
<meta property="og:description" content="SQL Server 是微软公司开发的关系型数据库管理系统（RDBMS），用于存储和管理数据。它提供了一种可靠的、安全的和高效的方式来管理大型数据集合，并提供了许多功能和工具，使开发人员能够轻松地创建和管理数据库应用程序。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-05-07T16:00:00.000Z">
<meta property="article:modified_time" content="2024-06-13T06:47:17.697Z">
<meta property="article:author" content="王小龙">
<meta property="article:tag" content="sqlserver">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://draco.wang/SQLServer/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://draco.wang/SQLServer/","path":"SQLServer/","title":"SQLServer"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SQLServer | 王小龙的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">王小龙的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E8%AF%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.</span> <span class="nav-text">初识数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.1.</span> <span class="nav-text">数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="nav-number">1.2.</span> <span class="nav-text">数据库相关概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%A7%E5%93%81"><span class="nav-number">1.3.</span> <span class="nav-text">常见的数据库产品</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E7%9A%84%E7%BB%84%E6%88%90"><span class="nav-number">1.4.</span> <span class="nav-text">SQL的组成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.5.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="nav-number">1.6.</span> <span class="nav-text">数据完整性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ubuntu%E5%AE%89%E8%A3%85SQLservice"><span class="nav-number">1.7.</span> <span class="nav-text">Ubuntu安装SQLservice</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">基本语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.2.</span> <span class="nav-text">删除数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-number">2.3.</span> <span class="nav-text">创建数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="nav-number">2.4.</span> <span class="nav-text">删除表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="nav-number">2.5.</span> <span class="nav-text">完整性约束</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0%E3%80%81%E6%9B%B4%E6%94%B9%E3%80%81%E5%88%A0%E9%99%A4"><span class="nav-number">3.</span> <span class="nav-text">增加、更改、删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="nav-number">3.1.</span> <span class="nav-text">新增数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-number">3.2.</span> <span class="nav-text">更新数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">3.3.</span> <span class="nav-text">删除数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.</span> <span class="nav-text">查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">4.1.</span> <span class="nav-text">查询数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F"><span class="nav-number">4.2.</span> <span class="nav-text">排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.3.</span> <span class="nav-text">表连接查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.4.</span> <span class="nav-text">子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.5.</span> <span class="nav-text">简单子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IN%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.6.</span> <span class="nav-text">IN子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EXISTS%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.7.</span> <span class="nav-text">EXISTS子查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">5.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">聚合函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.2.</span> <span class="nav-text">分组查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-number">5.3.</span> <span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-number">5.4.</span> <span class="nav-text">日期函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="nav-number">5.5.</span> <span class="nav-text">数学函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0"><span class="nav-number">5.6.</span> <span class="nav-text">系统函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B"><span class="nav-number">6.</span> <span class="nav-text">数据库编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="nav-number">6.1.</span> <span class="nav-text">局部变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">6.2.</span> <span class="nav-text">全局变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IF%E2%80%A6ELSE"><span class="nav-number">6.3.</span> <span class="nav-text">IF…ELSE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CASE%EF%BC%8DEND%E5%A4%9A%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5"><span class="nav-number">6.4.</span> <span class="nav-text">CASE－END多分支语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WHILE%E5%BE%AA%E7%8E%AF"><span class="nav-number">6.5.</span> <span class="nav-text">WHILE循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="nav-number">6.6.</span> <span class="nav-text">数据库设计</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E3%80%81%E7%B4%A2%E5%BC%95%E3%80%81%E8%A7%86%E5%9B%BE"><span class="nav-number">7.</span> <span class="nav-text">事务、索引、视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">7.1.</span> <span class="nav-text">事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">7.2.</span> <span class="nav-text">索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-number">7.3.</span> <span class="nav-text">视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.</span> <span class="nav-text">存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.1.</span> <span class="nav-text">系统存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.2.</span> <span class="nav-text">自定义存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%8F%82%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.3.</span> <span class="nav-text">无参的存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%A6%E6%9C%89%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.4.</span> <span class="nav-text">带有输入参数的存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="nav-number">8.5.</span> <span class="nav-text">设置输入参数的默认值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%A6%E6%9C%89%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.6.</span> <span class="nav-text">带有输出参数的存储过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">9.</span> <span class="nav-text">触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.1.</span> <span class="nav-text">触发器类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#After%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">9.2.</span> <span class="nav-text">After触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#instead-of%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">9.3.</span> <span class="nav-text">instead of触发器</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">王小龙</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://draco.wang/SQLServer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="王小龙">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王小龙的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SQLServer | 王小龙的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQLServer
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-08 00:00:00" itemprop="dateCreated datePublished" datetime="2024-05-08T00:00:00+08:00">2024-05-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-13 14:47:17" itemprop="dateModified" datetime="2024-06-13T14:47:17+08:00">2024-06-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>SQL Server 是微软公司开发的关系型数据库管理系统（RDBMS），用于存储和管理数据。它提供了一种可靠的、安全的和高效的方式来管理大型数据集合，并提供了许多功能和工具，使开发人员能够轻松地创建和管理数据库应用程序。</p>
<span id="more"></span>

<h2 id="初识数据库"><a href="#初识数据库" class="headerlink" title="初识数据库"></a>初识数据库</h2><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p><strong>数据库是按照数据模型存储在专门的存储器中。</strong><br><strong>特点</strong></p>
<ul>
<li><p>数据尽量不重复</p>
</li>
<li><p>以最优的方式为应用程序提供服务</p>
</li>
<li><p>通过专门的数据库软件管理数据，提供增删改查操作</p>
</li>
</ul>
<h3 id="数据库相关概念"><a href="#数据库相关概念" class="headerlink" title="数据库相关概念"></a>数据库相关概念</h3><p><strong>实体(Entity):</strong></p>
<p>客观存在的，可以被描述的事物称为实体。<br><strong>数据模型</strong></p>
<ul>
<li>层次模型<br>用树型结构描述实体和实体间的联系</li>
<li>网状模型<br>用有向图结构描述实体和实体间的联系</li>
<li>关系模型<br>用二维表描述实体和实体间的联系</li>
<li>键值对</li>
</ul>
<p><strong>数据库通常有两个主要部分</strong></p>
<ul>
<li>一个是保存数据库的物理文件</li>
<li>一个是应用程序用于访问数据的管理系统(DBMS:Data Base Management System),是应用程序和数据库之间的桥梁</li>
</ul>
<h3 id="常见的数据库产品"><a href="#常见的数据库产品" class="headerlink" title="常见的数据库产品"></a>常见的数据库产品</h3><p><strong>关系型数据库（RDB)</strong></p>
<ul>
<li>Oracle:大型</li>
<li>Sql Server:中大型</li>
<li>MySql:中小型</li>
</ul>
<p><strong>非关系型数据库（NoSql)</strong></p>
<ul>
<li>Redis</li>
<li>MongoDB</li>
</ul>
<h3 id="SQL的组成"><a href="#SQL的组成" class="headerlink" title="SQL的组成"></a>SQL的组成</h3><p>SQL（Structured Query Language）包含以下几个部分：</p>
<p><strong>DDL（Data Definition Language）数据定义语言</strong></p>
<p>DDL用于定义数据库的结构或模式，包括创建、修改和删除数据库对象，如表、索引等。常见的DDL命令包括CREATE、ALTER和DROP等。</p>
<p><strong>DML（Data Manipulation Language）数据操作语言</strong></p>
<p>DML用于对数据库中的数据进行操作，包括查询、插入、更新和删除数据。常见的DML命令包括SELECT、INSERT、UPDATE和DELETE等。</p>
<p><strong>DCL（Data Control Language）数据控制语言</strong></p>
<p>DCL用于控制数据库的访问权限和安全性，包括授权和撤销访问权限。常见的DCL命令包括GRANT和REVOKE等。</p>
<p><strong>TCL（Transaction Control Language）事务控制语言</strong></p>
<p>TCL用于管理数据库中的事务，包括事务的提交和回滚。常见的TCL命令包括COMMIT、ROLLBACK和SAVEPOINT等。</p>
<p>这些部分构成了SQL语言的基本框架，每个部分都有特定的功能和用途，用于不同层次和方面的数据库操作和管理。</p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>SQL中的数据类型用于定义表中列的数据类型。不同的数据库管理系统可能支持不同的数据类型，以下是一些常见的SQL数据类型：</p>
<p><strong>整数类型（Integer Types）</strong>：</p>
<ul>
<li>INT（整数类型）</li>
<li>SMALLINT（小整数类型）</li>
<li>BIGINT（大整数类型）</li>
</ul>
<p><strong>浮点数类型（Floating-Point Types）</strong>：</p>
<ul>
<li>FLOAT(n)（浮点数类型，可指定精度）</li>
<li>REAL（单精度浮点数）</li>
<li>DOUBLE PRECISION（双精度浮点数）</li>
</ul>
<p><strong>定点数类型（Fixed-Point Types）</strong>：</p>
<ul>
<li>DECIMAL(p, s) &#x2F; NUMERIC(p, s)（定点数类型，p为精度，s为小数位数）</li>
<li>MONEY（货币类型）</li>
</ul>
<p><strong>字符类型（Character Types）</strong>：</p>
<ul>
<li>CHAR(n)（固定长度字符类型）</li>
<li>VARCHAR(n)（可变长度字符类型）</li>
<li>TEXT（长文本类型）</li>
</ul>
<p><strong>日期与时间类型（Date and Time Types）</strong>：</p>
<ul>
<li>DATE（日期类型）</li>
<li>TIME（时间类型）</li>
<li>DATETIME（日期时间类型）</li>
<li>TIMESTAMP（时间戳类型）</li>
</ul>
<p><strong>布尔类型（Boolean Types）</strong>：</p>
<ul>
<li>BOOL（布尔类型）</li>
<li>BOOLEAN（布尔类型）</li>
</ul>
<p><strong>二进制类型（Binary Types）</strong>：</p>
<ul>
<li>BINARY(n)（固定长度二进制类型）</li>
<li>VARBINARY(n)（可变长度二进制类型）</li>
<li>BLOB（二进制大对象类型）</li>
</ul>
<p><strong>其他类型</strong>：</p>
<ul>
<li>ARRAY（数组类型）</li>
<li>JSON（JSON类型，用于存储JSON数据）</li>
</ul>
<p>这只是SQL中常见的一些数据类型，具体的数据类型还取决于所使用的数据库管理系统和版本。</p>
<h3 id="数据完整性"><a href="#数据完整性" class="headerlink" title="数据完整性"></a>数据完整性</h3><h3 id="Ubuntu安装SQLservice"><a href="#Ubuntu安装SQLservice" class="headerlink" title="Ubuntu安装SQLservice"></a>Ubuntu安装SQLservice</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -e &quot;ACCEPT_EULA=Y&quot; -e &quot;SA_PASSWORD=Abc@12332100&quot; -p 1433:1433 -v /home/sqlserver/data:/var/opt/mssql/data -v /home/sqlserver/log:/var/opt/mssql/log --name sqlserver -d mcr.microsoft.com/mssql/server</span><br><span class="line"></span><br><span class="line">scp ~/documents/CompanyDB.mdf  draco@xjbxjb.tpddns.cn:/home/draco/sqlserver/data</span><br><span class="line">scp ~/documents/CompanyDB_log.ldf draco@xjbxjb.tpddns.cn:/home/draco/sqlserver/data</span><br><span class="line"></span><br><span class="line">scp ~/documents/script.sql draco@xjbxjb.tpddns.cn:/home/draco/sqlserver/data</span><br><span class="line">StudentDB20240508.mdf</span><br><span class="line">scp ~/StudentDB20240508.mdf draco@xjbxjb.tpddns.cn:/home/draco/sqlserver/data</span><br><span class="line">StudentDB20240508.ldf</span><br><span class="line">scp ~/StudentDB20240508.ldf draco@xjbxjb.tpddns.cn:/home/draco/sqlserver/data</span><br></pre></td></tr></table></figure>



<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database StudentDB20240508</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">primary</span></span><br><span class="line">(</span><br><span class="line">	name<span class="operator">=</span><span class="string">&#x27;StudentDB20240508.mdf&#x27;</span>,</span><br><span class="line">	filename<span class="operator">=</span><span class="string">&#x27;G:\20240325班级\3-Sql Server\Day01-5.8\DB\StudentDB20240508.mdf&#x27;</span>,</span><br><span class="line">	size<span class="operator">=</span><span class="number">8</span>mb,</span><br><span class="line">	filegrowth<span class="operator">=</span><span class="number">10</span>mb</span><br><span class="line">)</span><br><span class="line">log <span class="keyword">on</span></span><br><span class="line">(</span><br><span class="line">	name<span class="operator">=</span><span class="string">&#x27;StudentDB20240508.ldf&#x27;</span>,</span><br><span class="line">	filename<span class="operator">=</span><span class="string">&#x27;G:\20240325班级\3-Sql Server\Day01-5.8\DB\StudentDB20240508.ldf&#x27;</span>,</span><br><span class="line">	size<span class="operator">=</span><span class="number">5</span>mb,</span><br><span class="line">	maxsize<span class="operator">=</span><span class="number">100</span>mb,</span><br><span class="line">	filegrowth<span class="operator">=</span><span class="number">10</span><span class="operator">%</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database StudentDB20240508</span><br><span class="line"></span><br><span class="line"><span class="comment">--设置可用数据库</span></span><br><span class="line">use StudentDB20240508</span><br></pre></td></tr></table></figure>

<h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><p>过程：</p>
<ul>
<li>确定表中有哪些列</li>
<li>确定列的数据类型</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建学生表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students</span><br><span class="line">(</span><br><span class="line">	sno <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,			 <span class="comment">--学号</span></span><br><span class="line">	sname <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,		 <span class="comment">--姓名</span></span><br><span class="line">	sex bit <span class="keyword">not</span> <span class="keyword">null</span>,				 <span class="comment">--性别</span></span><br><span class="line">	birthday <span class="type">date</span>,					 <span class="comment">--出生日期</span></span><br><span class="line">	phoneNo <span class="type">char</span>(<span class="number">11</span>),				 <span class="comment">--手机号码</span></span><br><span class="line">	email <span class="type">varchar</span>(<span class="number">50</span>),               <span class="comment">--电子邮箱</span></span><br><span class="line">	personID <span class="type">char</span>(<span class="number">18</span>)                <span class="comment">--身份证</span></span><br><span class="line">)</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改表结构</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span> address <span class="type">varchar</span>(<span class="number">50</span>)  <span class="comment">--增加列</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">column</span> address <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>  <span class="comment">--修改列</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">column</span> address    <span class="comment">--删除列</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建班级表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> classes</span><br><span class="line">(</span><br><span class="line">	classId <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,  <span class="comment">--班级编号</span></span><br><span class="line">	className <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,  <span class="comment">--班级名称</span></span><br><span class="line">	beginDate <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span>  <span class="comment">--开班日期	</span></span><br><span class="line">)</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span>  classId <span class="type">int</span></span><br></pre></td></tr></table></figure>

<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> classes</span><br></pre></td></tr></table></figure>

<h3 id="完整性约束"><a href="#完整性约束" class="headerlink" title="完整性约束"></a>完整性约束</h3><p><strong>实体完整性</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--主键(primary key)约束:不能为空，且不能重复</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> pk_sno <span class="keyword">primary</span> key(sno)</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> classes</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> pk_classId <span class="keyword">primary</span> key(classId)</span><br><span class="line"></span><br><span class="line"><span class="comment">--唯一约束：可以为空，但不能重复</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> uq_personId <span class="keyword">unique</span>(personID)</span><br><span class="line"></span><br><span class="line"><span class="comment">--标识列</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建课程表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> courses</span><br><span class="line">(</span><br><span class="line">	courseId <span class="type">int</span> <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,</span><br><span class="line">	courseName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">)</span><br><span class="line">go</span><br></pre></td></tr></table></figure>

<p><strong>域完整性</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--数据类型</span></span><br><span class="line"><span class="comment">--检查约束(Check)</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> ck_phoneNo <span class="keyword">check</span>(len(phoneNo)<span class="operator">=</span><span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> ck_email <span class="keyword">check</span>(email <span class="keyword">like</span> <span class="string">&#x27;_%@_%.com&#x27;</span>)</span><br><span class="line"><span class="comment">--drop constraint ck_email  --删除约束</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--非空约束 </span></span><br><span class="line"><span class="comment">--默认值</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> df_sex <span class="keyword">default</span>(<span class="number">1</span>) <span class="keyword">for</span> sex</span><br><span class="line"></span><br><span class="line"><span class="comment">--外键约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> fk_classId <span class="keyword">foreign</span> key(classId) <span class="keyword">references</span> classes(classId)</span><br><span class="line"></span><br><span class="line"><span class="comment">--注：创建了外键约束以后，</span></span><br><span class="line"><span class="comment">--新增数据时，先向主表中插入，再向子表中插入</span></span><br><span class="line"><span class="comment">--删除数据时，先从子表中删除数据，再从主表中删除数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-----创建表的同时添加约束</span></span><br><span class="line"><span class="comment">--创建班级表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> classes</span><br><span class="line">(</span><br><span class="line">	classId <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,  <span class="comment">--班级编号</span></span><br><span class="line">	className <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,  <span class="comment">--班级名称</span></span><br><span class="line">	beginDate <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span>  <span class="comment">--开班日期	</span></span><br><span class="line">)</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建学生表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students</span><br><span class="line">(</span><br><span class="line">	sno <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,			 <span class="comment">--学号</span></span><br><span class="line">	sname <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,					<span class="comment">--姓名</span></span><br><span class="line">	sex bit <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">default</span>(<span class="number">1</span>),				 <span class="comment">--性别</span></span><br><span class="line">	birthday <span class="type">date</span>,								<span class="comment">--出生日期</span></span><br><span class="line">	phoneNo <span class="type">char</span>(<span class="number">11</span>) <span class="keyword">check</span>(len(phoneNo)<span class="operator">=</span><span class="number">11</span>),				 <span class="comment">--手机号码</span></span><br><span class="line">	email <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">check</span>(email <span class="keyword">like</span> <span class="string">&#x27;_%@_%.com&#x27;</span>),               <span class="comment">--电子邮箱</span></span><br><span class="line">	personID <span class="type">char</span>(<span class="number">18</span>) <span class="keyword">check</span>(len(personID)<span class="operator">=</span><span class="number">18</span>),                <span class="comment">--身份证</span></span><br><span class="line">	classId <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">references</span> classes(classId)</span><br><span class="line">)</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建成绩表：保存考试的学员，每次考试的科目的成绩</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> scores</span><br><span class="line">(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">primary</span> key,   <span class="comment">--标识列</span></span><br><span class="line">	sno <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">references</span> students(sno), <span class="comment">--考试的学员学号</span></span><br><span class="line">	cId <span class="type">int</span> <span class="keyword">references</span> courses(courseId),   <span class="comment">--考试的课程号</span></span><br><span class="line">	score <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>                      <span class="comment">--分数</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="增加、更改、删除"><a href="#增加、更改、删除" class="headerlink" title="增加、更改、删除"></a>增加、更改、删除</h2><p>DML（数据操作语言）是用于操作数据库中存储的数据的语言。</p>
<h3 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--单行数据新增</span></span><br><span class="line"><span class="comment">--省略列名：值列表的个数和列的个数相同，数据类型要匹配</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> classes <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;java一班&#x27;</span>,<span class="string">&#x27;2024-5-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--加上列名：值的顺序和列的顺序 一致</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> classes(className,classId,beginDate) <span class="keyword">VALUES</span>(<span class="string">&#x27;java二班&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2024-5-2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--不能违反非空约束</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> classes(classId,className) <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="string">&#x27;java三班&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(sno,sname,sex,classId) <span class="keyword">VALUES</span>(<span class="string">&#x27;s001&#x27;</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--不能违反主键约束</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(sno,sname,sex,classId) <span class="keyword">VALUES</span>(<span class="string">&#x27;s001&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(sno,sname,sex,classId) <span class="keyword">VALUES</span>(<span class="string">&#x27;s002&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--不能违反检查约束</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students <span class="keyword">VALUES</span>(<span class="string">&#x27;s003&#x27;</span>,<span class="string">&#x27;rose&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;1995-9-8&#x27;</span>,<span class="string">&#x27;15858586969&#x27;</span>,<span class="string">&#x27;rose@163.com&#x27;</span>,<span class="string">&#x27;111222555888555777&#x27;</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--使用默认值</span></span><br><span class="line"><span class="comment">--省略列名</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(sno,sname,birthday,classId) <span class="keyword">VALUES</span>(<span class="string">&#x27;s004&#x27;</span>,<span class="string">&#x27;tonny&#x27;</span>,<span class="string">&#x27;1997-8-1&#x27;</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">--使用default作为默认值</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(sno,sname,sex,birthday,classId) <span class="keyword">VALUES</span>(<span class="string">&#x27;s005&#x27;</span>,<span class="string">&#x27;edwin&#x27;</span>,<span class="keyword">default</span>,<span class="string">&#x27;1996-8-1&#x27;</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--不能违反外键约束</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(sno,sname,birthday,classId) <span class="keyword">VALUES</span>(<span class="string">&#x27;s006&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;1994-8-1&#x27;</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--不能显示设置标识列的值</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> courses <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;C#&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> courses <span class="keyword">VALUES</span>(<span class="string">&#x27;C#&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> courses <span class="keyword">VALUES</span>(<span class="string">&#x27;HTML&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--多行数据新增</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> courses</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Sql Server&#x27;</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;LINQ&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> courses</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;ADO.NET&#x27;</span>),(<span class="string">&#x27;三层架构&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--UNION:合并结果集，去除重复的记录</span></span><br><span class="line"><span class="comment">--UNION ALL:合并结果集，不去除重复的记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>,<span class="string">&#x27;Sql Server&#x27;</span> <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>,<span class="string">&#x27;Sql Server&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> scores</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;s001&#x27;</span>,<span class="number">1</span>,<span class="number">56</span>),</span><br><span class="line">(<span class="string">&#x27;s001&#x27;</span>,<span class="number">2</span>,<span class="number">62</span>),</span><br><span class="line">(<span class="string">&#x27;s001&#x27;</span>,<span class="number">3</span>,<span class="number">71</span>),</span><br><span class="line">(<span class="string">&#x27;s001&#x27;</span>,<span class="number">4</span>,<span class="number">69</span>),</span><br><span class="line">(<span class="string">&#x27;s002&#x27;</span>,<span class="number">1</span>,<span class="number">53</span>),</span><br><span class="line">(<span class="string">&#x27;s002&#x27;</span>,<span class="number">2</span>,<span class="number">68</span>)</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ul>
<li>插入行时，行中有自动生成的列时，不要加上这个列名</li>
<li>用了nvarchar，中文字符会出现乱码，要值的前面加上N</li>
</ul>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students</span><br><span class="line"></span><br><span class="line"><span class="keyword">add</span> school <span class="type">varchar</span>(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--更新所有数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--修改所有学员的学校名称</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> school<span class="operator">=</span><span class="string">&#x27;苏州极客营软件培训中心&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--更新部分数据，同时更新多列的值，用逗号分隔</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--修改学号为s001的邮箱和手机号码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> phoneNo<span class="operator">=</span><span class="string">&#x27;15854741525&#x27;</span>,email<span class="operator">=</span><span class="string">&#x27;jack@163.com&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s001&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--将不及格的学员成绩提高5分</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> scores <span class="keyword">SET</span> score<span class="operator">=</span>score<span class="operator">+</span><span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> score<span class="operator">&lt;</span><span class="number">60</span></span><br></pre></td></tr></table></figure>

<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--删除数据时不能违反外键约束</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> courses</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除所有的数据时，标识列不会重置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> scores</span><br><span class="line"></span><br><span class="line"><span class="comment">--截断整张表的数据，在功能上和DELETE FROM scores 相同</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> scores</span><br><span class="line"></span><br><span class="line"><span class="comment">--注意：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--(1)DELETE FROM scores ，标识列不重置，继续增加；TRUNCATE TABLE scores，标识列重置为标识种子</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--(2)对于有引用关系的表，即使没有数据的引用，也无法使用TRUNCATE TABLE courses删除；但可以使用DELETE FROM courses</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> courses</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> courses</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> scores</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop constraint  FK__scores__cId__5070F446</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> FK__scores__cId__5070F446 <span class="keyword">foreign</span> key(cId) <span class="keyword">references</span> courses(courseId)</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除部分数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--删除不及格的学员成绩</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> score<span class="operator">&lt;</span><span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--删除班级编号为1的男生的信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students </span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> classId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> sex<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p><strong>查询全部的行和列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--*：匹配所有的列</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students</span><br></pre></td></tr></table></figure>

<p><strong>查询部分列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询学生的学号，姓名和性别</span></span><br><span class="line"><span class="keyword">SELECT</span> sno,sname,sex</span><br><span class="line"><span class="keyword">FROM</span> students</span><br></pre></td></tr></table></figure>

<p><strong>查询部分行</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询所有男生的信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sex<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询班级编号是1的所有男生信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sex<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> classId<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong>给列命名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sno <span class="keyword">AS</span> <span class="string">&#x27;学号&#x27;</span>,sname <span class="keyword">AS</span> <span class="string">&#x27;姓名&#x27;</span>,<span class="string">&#x27;性别&#x27;</span><span class="operator">=</span>sex,sno<span class="operator">+</span><span class="string">&#x27;.&#x27;</span><span class="operator">+</span>sname <span class="keyword">AS</span> <span class="string">&#x27;学号和姓名&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br></pre></td></tr></table></figure>

<p><strong>使用常量列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,<span class="string">&#x27;苏州极客营&#x27;</span> <span class="keyword">AS</span> <span class="string">&#x27;学校&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br></pre></td></tr></table></figure>

<p><strong>限制行数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">3</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">30</span> <span class="keyword">percent</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br></pre></td></tr></table></figure>

<p><strong>模糊查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询姓名以t打头的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sname <span class="keyword">like</span> <span class="string">&#x27;t%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询姓名包含t的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sname <span class="keyword">like</span> <span class="string">&#x27;%t%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询学号是s001-s003</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">like</span> <span class="string">&#x27;s00[1-3]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">like</span> <span class="string">&#x27;s00[^1-3]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;s00[1-3]&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>查询字段值为空的</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询邮箱为空的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p><strong>查询指定范围内的</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询成绩在90-100之间的成绩信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> score<span class="operator">&gt;=</span><span class="number">90</span> <span class="keyword">AND</span> score<span class="operator">&lt;=</span><span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> score <span class="keyword">BETWEEN</span> <span class="number">90</span> <span class="keyword">AND</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> score <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">90</span> <span class="keyword">AND</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>

<p><strong>查询在指定查询内容列表中的</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询班级是1号或3号或4号的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> classId<span class="operator">=</span><span class="number">1</span> <span class="keyword">OR</span> classId<span class="operator">=</span><span class="number">3</span> <span class="keyword">OR</span> classId<span class="operator">=</span><span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> classId <span class="keyword">IN</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p><strong>IN的指定内容列表，也可以是另一个子查询的结果</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询课程名称为C#或HTML的考试成绩信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> cId <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> courseId</span><br><span class="line">	<span class="keyword">FROM</span> courses</span><br><span class="line">	<span class="keyword">WHERE</span> courseName <span class="keyword">IN</span>(<span class="string">&#x27;C#&#x27;</span>,<span class="string">&#x27;HTML&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> cId <span class="keyword">NOT</span> <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> courseId</span><br><span class="line">	<span class="keyword">FROM</span> courses</span><br><span class="line">	<span class="keyword">WHERE</span> courseName <span class="keyword">IN</span>(<span class="string">&#x27;C#&#x27;</span>,<span class="string">&#x27;HTML&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询jack的考试成绩信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="operator">=</span>(</span><br><span class="line">  <span class="keyword">SELECT</span> sno</span><br><span class="line">  <span class="keyword">FROM</span> students</span><br><span class="line">  <span class="keyword">WHERE</span> sname<span class="operator">=</span><span class="string">&#x27;jack&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> birthday <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询学号为s001的学员的考试成绩，并按成绩降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s001&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询出课程编号为1号的前三名的考试成绩</span></span><br><span class="line"><span class="comment">--WITH TIES:是TOP N 的可选项，表示可以查询到和最后一个排序的值相同的也能查询到</span></span><br><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">3</span> <span class="keyword">WITH</span> TIES <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,score<span class="operator">+</span><span class="number">2</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> score<span class="operator">+</span><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><strong>按多列排序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cId,score <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h3 id="表连接查询"><a href="#表连接查询" class="headerlink" title="表连接查询"></a>表连接查询</h3><ul>
<li><p>当查询数据时，需要从多张表中获得数据，使用表连接查询实现。</p>
</li>
<li><p>表连接的分类</p>
<ul>
<li><p>内连接</p>
</li>
<li><p>外连接（左外连接，右外连接）</p>
</li>
</ul>
</li>
</ul>
<p><strong>内连接</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--按照连接条件，把两张表中满足连接条件的记录合并生成一条记录</span></span><br><span class="line"><span class="comment">--查询考试学员的姓名，以及考试的课程号和成绩</span></span><br><span class="line"><span class="comment">--姓名：Students</span></span><br><span class="line"><span class="comment">--课程号和成绩：Scores</span></span><br><span class="line"><span class="comment">--连接条件：两张表的学号相同</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname,sc.cId,sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> scores sc</span><br><span class="line"><span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno</span><br><span class="line"><span class="comment">--改变表的顺序，不影响结果</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname,sc.cId,sc.score</span><br><span class="line"><span class="keyword">FROM</span> scores sc</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> students s</span><br><span class="line"><span class="keyword">ON</span> sc.sno<span class="operator">=</span>s.sno</span><br><span class="line"><span class="comment">--另一种内连接的语法：</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname,sc.cId,sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s,scores sc</span><br><span class="line"><span class="keyword">WHERE</span> s.sno<span class="operator">=</span>sc.sno</span><br><span class="line"><span class="comment">--查询哪些课程被学员考试，显示课程名，考试的学号和成绩</span></span><br><span class="line"><span class="keyword">SELECT</span> c.courseName , sc.sno,sc.score</span><br><span class="line"><span class="keyword">FROM</span> courses c, scores sc</span><br><span class="line"><span class="keyword">WHERE</span> c.courseId<span class="operator">=</span>sc.cId</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.cId</span><br><span class="line"><span class="comment">--查询考试学员的姓名，考试的课程名称，成绩</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname,c.courseName,sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s <span class="keyword">INNER</span> <span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.cId<span class="operator">=</span>c.courseId</span><br><span class="line"><span class="keyword">SELECT</span> s.sname,c.courseName,sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s,courses c,scores sc</span><br><span class="line"><span class="keyword">WHERE</span> s.sno<span class="operator">=</span>sc.sno <span class="keyword">AND</span> c.courseId<span class="operator">=</span>sc.cId</span><br><span class="line"><span class="comment">--查询参加了考试的学员姓名，考试的科目数以及平均分</span></span><br><span class="line"><span class="comment">--物理表连接虚拟表</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname,temp.count,temp.avg</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> sno,count<span class="operator">=</span><span class="built_in">COUNT</span>(sno),avg<span class="operator">=</span><span class="built_in">AVG</span>(score)</span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sno</span><br><span class="line">)temp</span><br><span class="line"><span class="keyword">ON</span> s.sno<span class="operator">=</span>temp.sno</span><br><span class="line"><span class="comment">--查询参加了1号和2号课程考试的学号</span></span><br><span class="line"><span class="comment">--两张表自连接</span></span><br><span class="line"><span class="keyword">SELECT</span> sc.sno</span><br><span class="line"><span class="keyword">FROM</span> scores sc</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> scores sc1 <span class="keyword">ON</span> sc.sno<span class="operator">=</span>sc1.sno</span><br><span class="line"><span class="keyword">WHERE</span> sc.cId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> sc1.cId<span class="operator">=</span><span class="number">2</span></span><br><span class="line"><span class="comment">--查询参加了1号和2号课程考试的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> sc.sno</span><br><span class="line"><span class="keyword">FROM</span> scores sc</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> scores sc1 <span class="keyword">ON</span> sc.sno<span class="operator">=</span>sc1.sno</span><br><span class="line"><span class="keyword">WHERE</span> sc.cId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> sc1.cId<span class="operator">=</span><span class="number">2</span></span><br><span class="line">) temp <span class="keyword">ON</span> s.sno<span class="operator">=</span>temp.sno</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">WHERE</span> s.sno <span class="keyword">IN</span> (<span class="keyword">SELECT</span> sc.sno</span><br><span class="line"><span class="keyword">FROM</span> scores sc</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> scores sc1 <span class="keyword">ON</span> sc.sno<span class="operator">=</span>sc1.sno</span><br><span class="line"><span class="keyword">WHERE</span> sc.cId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> sc1.cId<span class="operator">=</span><span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><strong>左外连接</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--SELECT 查询的列</span></span><br><span class="line"><span class="comment">--FROM 表1</span></span><br><span class="line"><span class="comment">--LEFT JOIN 表2 ON 连接条件</span></span><br><span class="line"><span class="comment">--返回表1中的所有数据，如果和表2没有符合连接条件的记录，则表2中的列以NULL返回</span></span><br><span class="line"><span class="comment">--查询所有学员的姓名，以及考试的课程号和成绩</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname,sc.cId,sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> scores sc</span><br><span class="line"><span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno</span><br></pre></td></tr></table></figure>

<p><strong>外连接，表的顺序不能改变</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.sname,sc.cId,sc.score</span><br><span class="line"><span class="keyword">FROM</span>  scores sc</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> students s</span><br><span class="line"><span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno</span><br><span class="line"><span class="comment">--查询没有参加考试的学员姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> scores sc</span><br><span class="line"><span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno</span><br><span class="line"><span class="keyword">WHERE</span> sc.cId <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">WHERE</span> s.sno <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> sno <span class="keyword">FROM</span> scores)</span><br></pre></td></tr></table></figure>

<p><strong>右外连接</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--SELECT 查询的列</span></span><br><span class="line"><span class="comment">--FROM 表1</span></span><br><span class="line"><span class="comment">--RIGHT JOIN 表2 ON 连接条件</span></span><br><span class="line"><span class="comment">--返回表2中的所有数据，如果和表1没有符合连接条件的记录，则表1中的列以NULL返回</span></span><br><span class="line"><span class="keyword">SELECT</span> s.sname,sc.cId,sc.score</span><br><span class="line"><span class="keyword">FROM</span>  scores sc</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> students s</span><br><span class="line"><span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno</span><br></pre></td></tr></table></figure>

<p><strong>外连接案例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE BankDB</span><br><span class="line">GO</span><br><span class="line">USE BankDB</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users</span><br><span class="line">(</span><br><span class="line">cardId <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">userName <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">)</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> accounts</span><br><span class="line">(</span><br><span class="line">countID <span class="type">int</span> <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">primary</span> key,</span><br><span class="line">cardId <span class="type">int</span> <span class="keyword">references</span> users(cardId),</span><br><span class="line">balance money</span><br><span class="line">)</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">16</span>,<span class="string">&#x27;张三&#x27;</span>),(<span class="number">23</span>,<span class="string">&#x27;李四&#x27;</span>),(<span class="number">25</span>,<span class="string">&#x27;王五&#x27;</span>),(<span class="number">29</span>,<span class="string">&#x27;赵六&#x27;</span>),(<span class="number">30</span>,<span class="string">&#x27;钱七&#x27;</span>)</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> accounts</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">16</span>,<span class="number">50</span>),(<span class="number">25</span>,<span class="number">300</span>),(<span class="number">29</span>,<span class="number">160</span>)</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts</span><br><span class="line"><span class="comment">--将查询到数据插入到账户表中</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> accounts</span><br><span class="line"><span class="keyword">SELECT</span> u.cardId,<span class="number">2</span></span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> accounts a</span><br><span class="line"><span class="keyword">on</span> u.cardId<span class="operator">=</span>a.cardId</span><br><span class="line"><span class="keyword">WHERE</span> a.cardId <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>


<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>嵌套在另一个SQL语句的查询称为子查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students</span><br><span class="line"><span class="comment">--查询比tom学员年龄大的学员信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--（1步）先查询tom的年龄</span></span><br><span class="line"><span class="keyword">SELECT</span> age<span class="operator">=</span>DATEDIFF(<span class="keyword">YEAR</span>,birthday,GETDATE())</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sname<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--(2步) 再筛选出出tom大的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,DATEDIFF(<span class="keyword">YEAR</span>,birthday,GETDATE())</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> DATEDIFF(<span class="keyword">YEAR</span>,birthday,GETDATE())<span class="operator">&gt;</span></span><br><span class="line">(</span><br><span class="line">    <span class="comment">--子查询</span></span><br><span class="line">    <span class="keyword">SELECT</span> age<span class="operator">=</span>DATEDIFF(<span class="keyword">YEAR</span>,birthday,GETDATE())</span><br><span class="line">    <span class="keyword">FROM</span> students</span><br><span class="line">    <span class="keyword">WHERE</span> sname<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="简单子查询"><a href="#简单子查询" class="headerlink" title="简单子查询"></a>简单子查询</h3><p>使用比较运算符将子查询和外层查询结合在一起的，这种子查询称为简单子查询<br>特点：保证子查询返回的值不能多于一个</p>
<h3 id="IN子查询"><a href="#IN子查询" class="headerlink" title="IN子查询"></a>IN子查询</h3><p>使用IN运算符将子查询和外层查询结合中一起的。<br>特点：保证子查询返回的列不能多于一个</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询考试成绩刚好及格的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> sno</span><br><span class="line">    <span class="keyword">FROM</span> scores</span><br><span class="line">    <span class="keyword">WHERE</span> score<span class="operator">=</span><span class="number">60</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询没有被学员考试的课程信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> courses </span><br><span class="line"><span class="keyword">WHERE</span> courseId <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> cId</span><br><span class="line">    <span class="keyword">FROM</span> scores</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除没有参加考试的学员信息</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> sno <span class="keyword">FROM</span> scores)</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询参加考试的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students s <span class="keyword">INNER</span> <span class="keyword">JOIN</span> scores sc</span><br><span class="line"><span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">IN</span>(<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> sno <span class="keyword">FROM</span> scores)</span><br></pre></td></tr></table></figure>

<p>总结：简单子查询和IN子查询的查询过程：</p>
<ul>
<li>先执行子查询，并将查询结果缓存</li>
<li>再执行外层的查询</li>
</ul>
<h3 id="EXISTS子查询"><a href="#EXISTS子查询" class="headerlink" title="EXISTS子查询"></a>EXISTS子查询</h3><p>检查子查询是否至少返回一条记录，如果返回了记录，则EXISTS条件 成立，否则EXISTS条件不成立</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">IF <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sysdatabases <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;StudentDB20240508&#x27;</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;数据库存在&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">    PRINT <span class="string">&#x27;数据库不存在&#x27;</span></span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">USE StudentDB20240508</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">IF <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sysobjects <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;students&#x27;</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;学生表已存在&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> </span><br><span class="line">    PRINT <span class="string">&#x27;学生表不存在&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询参加了考试了学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> scores sc <span class="keyword">WHERE</span> s.sno<span class="operator">=</span>sc.sno)</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询参加了1号和2号课程考试的学员信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores sc</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores sc <span class="keyword">WHERE</span> s.sno<span class="operator">=</span>sc.sno <span class="keyword">AND</span> sc.cId<span class="operator">=</span><span class="number">1</span>) <span class="comment">--学员考了1号课程</span></span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores sc1 <span class="keyword">WHERE</span> s.sno<span class="operator">=</span>sc1.sno <span class="keyword">AND</span> sc1.cId<span class="operator">=</span><span class="number">2</span>) <span class="comment">--同一个学员考了2号课程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询没有参加考试的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores sc <span class="keyword">WHERE</span> s.sno<span class="operator">=</span>sc.sno)</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--SUM()</span></span><br><span class="line"><span class="comment">--查询学号为s001的学员的总成绩</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(score) <span class="keyword">AS</span> <span class="string">&#x27;总分&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s001&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--注意：</span></span><br><span class="line"><span class="comment">--(1)如果SELECT中使用了聚合函数，那么除了聚合函数以外的其它列也要使用聚合函数或分组</span></span><br><span class="line"><span class="comment">--(2)聚合不应出现在 WHERE 子句中</span></span><br><span class="line"><span class="keyword">SELECT</span> sno, <span class="built_in">SUM</span>(score) <span class="keyword">AS</span> <span class="string">&#x27;总分&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s001&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--MAX():最大值</span></span><br><span class="line"><span class="comment">--MIN():最小值</span></span><br><span class="line"><span class="comment">--AVG():平均值</span></span><br><span class="line"><span class="comment">--COUNT():个数</span></span><br><span class="line"><span class="comment">--查询1号课程的最高分，最低分和平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;最高分&#x27;</span><span class="operator">=</span><span class="built_in">MAX</span>(score),<span class="string">&#x27;最低分&#x27;</span><span class="operator">=</span><span class="built_in">MIN</span>(score),<span class="string">&#x27;平均分&#x27;</span><span class="operator">=</span><span class="built_in">AVG</span>(score),<span class="string">&#x27;次数&#x27;</span><span class="operator">=</span><span class="built_in">COUNT</span>(cId)</span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询1号课程最高分的考试成绩信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> score<span class="operator">=</span><span class="built_in">MAX</span>(score)  <span class="comment">--聚合不应出现在 WHERE 子句中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> score<span class="operator">=</span>(<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(score) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询1号课程最高分的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students </span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="operator">=</span></span><br><span class="line">(</span><br><span class="line">	<span class="keyword">SELECT</span> sno</span><br><span class="line">	<span class="keyword">FROM</span> scores </span><br><span class="line">	<span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> score<span class="operator">=</span></span><br><span class="line">	(</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(score) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line">	)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询所有男生的人数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(sno)</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sex<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(sno)</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sex<span class="operator">=</span><span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询男生和女生的人数</span></span><br><span class="line"><span class="keyword">SELECT</span> sex,<span class="built_in">COUNT</span>(sno) <span class="keyword">AS</span> <span class="string">&#x27;人数&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sex</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 人数 <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询每个学员的最高分和平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> sno,<span class="built_in">MAX</span>(score) <span class="keyword">AS</span> <span class="string">&#x27;最高分&#x27;</span>,<span class="built_in">AVG</span>(score) <span class="keyword">AS</span> <span class="string">&#x27;平均分&#x27;</span>,<span class="built_in">COUNT</span>(sno) <span class="keyword">AS</span> <span class="string">&#x27;次数&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sno</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询每个学员每门课程的考试次数</span></span><br><span class="line"><span class="keyword">SELECT</span> sno,cId,<span class="built_in">COUNT</span>(sno) <span class="keyword">AS</span> <span class="string">&#x27;次数&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sno,cId</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sno</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询参加了补考的学员信息</span></span><br><span class="line"><span class="comment">--HAVING是GROUP BY的可选子句</span></span><br><span class="line"><span class="comment">--分组之后的筛选，可以使用聚合函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sno <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">	<span class="keyword">SELECT</span> sno</span><br><span class="line">	<span class="keyword">FROM</span> scores</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> sno,cId</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(sno)<span class="operator">&gt;</span><span class="number">1</span>  </span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> cId,<span class="built_in">AVG</span>(score)</span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cId</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cId,<span class="built_in">AVG</span>(score)</span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">WHERE</span> score<span class="operator">&gt;</span><span class="number">60</span>    <span class="comment">--(1)</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cId      <span class="comment">--(2)</span></span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(cId)<span class="operator">=</span><span class="number">1</span><span class="comment">--(3)</span></span><br></pre></td></tr></table></figure>

<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1.CHARINDEX:查找字符串在另一个字符串中第一次出现的位置，从1开始，如果没有查找到，则返回0</span></span><br><span class="line"><span class="keyword">SELECT</span> CHARINDEX(<span class="string">&#x27;C#&#x27;</span>,<span class="string">&#x27;C#程序设计&#x27;</span>)</span><br><span class="line"><span class="keyword">SELECT</span> CHARINDEX(<span class="string">&#x27;C#&#x27;</span>,<span class="string">&#x27;C#程序设计&#x27;</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询姓名以t打头的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> CHARINDEX(<span class="string">&#x27;t&#x27;</span>,sname)<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--2.LEN:返回字符串的长度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询学员姓名长度超过4个字符的学员姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> sname,LEN(sname) <span class="keyword">AS</span> <span class="string">&#x27;长度&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> LEN(sname)<span class="operator">&gt;</span><span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--3.LOWER():小写</span></span><br><span class="line"><span class="comment">--UPPER():大写</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(sname)</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"></span><br><span class="line"><span class="comment">--4.LTRIM():去除左边空格</span></span><br><span class="line"><span class="comment">--RTRIM():去除右边空格</span></span><br><span class="line"><span class="keyword">SELECT</span> RTRIM(sno)<span class="operator">+</span><span class="string">&#x27;.&#x27;</span><span class="operator">+</span>sname</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"></span><br><span class="line"><span class="comment">--5.LEFT():从字符串左边返回指定数目的字符</span></span><br><span class="line"><span class="comment">--RIGHT():从字符串右边返回指定数目的字符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;江苏省苏州市&#x27;</span>,<span class="number">2</span>),<span class="keyword">RIGHT</span>(<span class="string">&#x27;江苏省苏州市&#x27;</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--6.REPLACE():替换一个字符串中的字符</span></span><br><span class="line"><span class="keyword">SELECT</span> REPLACE(<span class="string">&#x27;苏州极客营软件培训中心&#x27;</span>,<span class="string">&#x27;极客营&#x27;</span>,<span class="string">&#x27;igeekhome&#x27;</span>)</span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> school<span class="operator">=</span>REPLACE(school,<span class="string">&#x27;极客营&#x27;</span>,<span class="string">&#x27;igeekhome&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--7.STUFF():在一个字符串中，删除指定长度的字符，并在该位置插入一个新的字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> STUFF(<span class="string">&#x27;苏州极客营软件培训中心&#x27;</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1.GETDATE():取得当前的系统日期</span></span><br><span class="line"><span class="keyword">SELECT</span> GETDATE()</span><br><span class="line"></span><br><span class="line"><span class="comment">--2.DATEDIFF():两个日期之间的指定日期部分的区别</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(YYYY,<span class="string">&#x27;1995-5-9&#x27;</span>,GETDATE())</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询学员的年龄</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,<span class="string">&#x27;年龄&#x27;</span><span class="operator">=</span>DATEDIFF(MM,birthday,GETDATE())</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"></span><br><span class="line"><span class="comment">--3.DATEADD():将指定的数值添加到指定的日期部分后的日期</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEADD(<span class="keyword">YEAR</span>,<span class="number">-2</span>,GETDATE())</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATEADD(<span class="keyword">MONTH</span>,<span class="number">12</span>,GETDATE())</span><br><span class="line"></span><br><span class="line"><span class="comment">--4.DATEPART():日期中指定日期部分的整数形式</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEPART(YYYY,GETDATE())</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询本月过生日的学员信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> DATEPART(<span class="keyword">MONTH</span>,GETDATE())<span class="operator">=</span>DATEPART(<span class="keyword">MONTH</span>,birthday)</span><br><span class="line"></span><br><span class="line"><span class="comment">--5.DATENAME():日期中指定日期部分的字符串形式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATENAME(WEEKDAY,GETDATE())</span><br></pre></td></tr></table></figure>

<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1.ABS():绝对值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--2.CEILING():向上取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEILING</span>(<span class="number">43.05</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--3.FLOOR()：向下取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">43.9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--4.ROUND():四舍五入</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">43.05</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--5.POWER():取数值表达式的幂值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">POWER</span>(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--6.Sign():符号</span></span><br><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">-10</span>),SIGN(<span class="number">10</span>),SIGN(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--7.Sqrt():平方根</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SQRT</span>(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h3 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1.CONVERT()</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONVERT</span>(<span class="type">varchar</span>(<span class="number">10</span>),<span class="number">100</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONVERT</span>(<span class="type">varchar</span>(<span class="number">50</span>),GETDATE(),<span class="number">101</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONVERT</span>(<span class="type">varchar</span>(<span class="number">50</span>),GETDATE(),<span class="number">102</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONVERT</span>(<span class="type">varchar</span>(<span class="number">50</span>),GETDATE(),<span class="number">110</span>)</span><br><span class="line"><span class="comment">--2.DATALENGTH():返回字节数</span></span><br><span class="line"><span class="keyword">SELECT</span> DATALENGTH(<span class="string">&#x27;Sql查询&#x27;</span>)</span><br><span class="line"><span class="keyword">SELECT</span> sname,DATALENGTH(sname),sno,DATALENGTH(sno)</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="comment">--3.CURRENT_USER:dbo(database owner)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_USER</span></span><br><span class="line"><span class="comment">--4.HOST_NAME</span></span><br><span class="line"><span class="keyword">SELECT</span> HOST_NAME()</span><br><span class="line"><span class="comment">--5.SYSTEM_USER</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SYSTEM_USER</span></span><br></pre></td></tr></table></figure>

<h2 id="数据库编程"><a href="#数据库编程" class="headerlink" title="数据库编程"></a>数据库编程</h2><h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--声明局部变量,可以同时声明多个变量，用逗号分隔</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@name</span> <span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@age</span> <span class="type">INT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--使用SET给变量赋值，只能给一个变量赋值</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@name</span><span class="operator">=</span><span class="string">&#x27;jack&#x27;</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@age</span><span class="operator">=</span><span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--使用SELECT给变量赋值，可以将查询的结果赋值给变量，也可以将常量值赋值给变量，可以同时给多个变量赋值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@name</span><span class="operator">=</span><span class="string">&#x27;JACK&#x27;</span>,<span class="variable">@age</span><span class="operator">=</span><span class="number">21</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--使用变量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@name</span></span><br><span class="line">PRINT <span class="string">&#x27;姓名：&#x27;</span><span class="operator">+</span><span class="variable">@name</span></span><br><span class="line">GO   <span class="comment">--批处理标志</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询出比jack年龄大的学员信息</span></span><br><span class="line"><span class="comment">--声明变量保存jack的年龄</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@age</span> <span class="type">INT</span>,<span class="variable">@sno</span> <span class="type">varchar</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--将查询到的数据保存在变量中</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@age</span><span class="operator">=</span>DATEDIFF(<span class="keyword">YEAR</span>,birthday,GETDATE()),<span class="variable">@sno</span><span class="operator">=</span>sno</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> sname<span class="operator">=</span><span class="string">&#x27;jack&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@sno</span>,<span class="variable">@age</span></span><br><span class="line"></span><br><span class="line">PRINT <span class="string">&#x27;jack的年龄是：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">varchar</span>(<span class="number">10</span>),<span class="variable">@age</span>)</span><br><span class="line">PRINT <span class="string">&#x27;比jack年龄大的学员有：&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> DATEDIFF(<span class="keyword">YEAR</span>,birthday,GETDATE())<span class="operator">&gt;</span><span class="variable">@age</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p>由系统声明和维护，只能使用，不能修改它的值</p>
<p><strong>@@ERROR</strong><br>最后一个T-SQL错误的错误号<br>@@ERROR之前的T-SQL语句的错误号，没有错误，则返回0，有错误则返回错误号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s001&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students</span><br><span class="line">PRINT @<span class="variable">@ERROR</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p><strong>@@ROWCOUNT</strong><br>受上一个SQL语句影响的行数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s001&#x27;</span></span><br><span class="line">PRINT @<span class="variable">@ROWCOUNT</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p><strong>@@IDENTITY</strong><br>最后一次插入的标识值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO scores VALUES(&#x27;s004&#x27;,1,85),(&#x27;s004&#x27;,2,70)</span><br><span class="line">PRINT @@ROWCOUNT</span><br><span class="line">PRINT @@IDENTITY</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p><strong>@@LANGUAGE</strong><br>当前使用的语言的名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PRINT @<span class="variable">@LANGUAGE</span></span><br></pre></td></tr></table></figure>

<p><strong>@@MAX_CONNECTIONS</strong><br>可以创建的同时连接的最大数目</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PRINT @<span class="variable">@MAX_CONNECTIONS</span></span><br></pre></td></tr></table></figure>

<p><strong>@@SERVERNAME</strong><br>本地服务器的名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PRINT @<span class="variable">@SERVERNAME</span></span><br></pre></td></tr></table></figure>

<p><strong>@@VERSION</strong><br>SQL Server的版本信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PRINT @<span class="variable">@VERSION</span></span><br></pre></td></tr></table></figure>

<h3 id="IF…ELSE"><a href="#IF…ELSE" class="headerlink" title="IF…ELSE"></a>IF…ELSE</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--统计出C#课程的平均分，如果平均分在80以上，则显示成绩优秀， 并显示出考试的前三名成绩信息；否则显示成绩一般，并显示出后三名成绩信息</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@courseId</span> <span class="type">INT</span>,<span class="variable">@avgScore</span> <span class="type">INT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询c#的课程号，保存在变量中</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@courseId</span><span class="operator">=</span>courseId</span><br><span class="line"><span class="keyword">FROM</span> courses  <span class="keyword">WHERE</span> courseName<span class="operator">=</span><span class="string">&#x27;C#&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询c#的平均分，保存在变量中</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="variable">@avgScore</span><span class="operator">=</span><span class="built_in">AVG</span>(score) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="variable">@courseId</span></span><br><span class="line"></span><br><span class="line">PRINT <span class="string">&#x27;c#的平均分是：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@avgScore</span>)</span><br><span class="line"></span><br><span class="line">IF <span class="variable">@avgScore</span><span class="operator">&gt;</span><span class="number">80</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    PRINT <span class="string">&#x27;成绩优秀&#x27;</span></span><br><span class="line">    <span class="keyword">SELECT</span> TOP <span class="number">3</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="variable">@courseId</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    PRINT <span class="string">&#x27;成绩一般&#x27;</span></span><br><span class="line">    <span class="keyword">SELECT</span> TOP <span class="number">3</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="variable">@courseId</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">ASC</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<h3 id="CASE－END多分支语句"><a href="#CASE－END多分支语句" class="headerlink" title="CASE－END多分支语句"></a>CASE－END多分支语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--显示学员信息，性别显示为男或女</span></span><br><span class="line"><span class="keyword">SELECT</span> sno,sname,sex<span class="operator">=</span><span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex<span class="operator">=</span><span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">WHEN</span> sex<span class="operator">=</span><span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;女&#x27;</span> <span class="keyword">END</span>,birthday</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line">GO</span><br><span class="line"><span class="comment">--等值判断</span></span><br><span class="line"><span class="keyword">SELECT</span> sno,sname,sex<span class="operator">=</span><span class="keyword">CASE</span> sex <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;女&#x27;</span> <span class="keyword">END</span>,birthday</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line">GO</span><br><span class="line"><span class="comment">--显示学员的考试成绩，并根据考试成绩显示等级</span></span><br><span class="line"><span class="comment">--90（包含）-100    A</span></span><br><span class="line"><span class="comment">--80(包含）-90     B</span></span><br><span class="line"><span class="comment">--70(包含）-80     C</span></span><br><span class="line"><span class="comment">--60(包含）-70     D</span></span><br><span class="line"><span class="comment">--低于60          E</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,level<span class="operator">=</span><span class="keyword">CASE</span> <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">90</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">                    <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">80</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">                    <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">70</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line">                    <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">60</span> <span class="keyword">THEN</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line">                    <span class="keyword">ELSE</span> <span class="string">&#x27;E&#x27;</span> <span class="keyword">END</span></span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="comment">--更新数据</span></span><br><span class="line"><span class="comment">--90（包含）-100    </span></span><br><span class="line"><span class="comment">--80(包含）-90     +2</span></span><br><span class="line"><span class="comment">--70(包含）-80     +3</span></span><br><span class="line"><span class="comment">--60(包含）-70     +4</span></span><br><span class="line"><span class="comment">--低于60          +5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> scores <span class="keyword">SET</span> score<span class="operator">=</span><span class="keyword">CASE</span> <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">90</span> <span class="keyword">THEN</span> score</span><br><span class="line">                             <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">80</span> <span class="keyword">THEN</span> score<span class="operator">+</span><span class="number">2</span></span><br><span class="line">                             <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">70</span> <span class="keyword">THEN</span> score<span class="operator">+</span><span class="number">3</span></span><br><span class="line">                             <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">60</span> <span class="keyword">THEN</span> score<span class="operator">+</span><span class="number">4</span></span><br><span class="line">                             <span class="keyword">ELSE</span> score<span class="operator">+</span><span class="number">5</span> <span class="keyword">END</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<h3 id="WHILE循环"><a href="#WHILE循环" class="headerlink" title="WHILE循环"></a>WHILE循环</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--由于1号课程较难，成绩较低，现在要对1号课程进行提分，确保每个学员都能及格，</span></span><br><span class="line"><span class="comment">--先每个加2分，判断是否有人不及格，如果还有人不及格，继续加2分，直到所有人都及格</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line">GO</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@noPassCount</span> <span class="type">INT</span> ,<span class="variable">@count</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@count</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> scores <span class="keyword">SET</span> score<span class="operator">=</span>score<span class="operator">+</span><span class="number">2</span> </span><br><span class="line"><span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@count</span><span class="operator">=</span><span class="variable">@count</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">PRINT <span class="string">&#x27;提分次数：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@count</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@noPassCount</span><span class="operator">=</span><span class="built_in">COUNT</span>(cId) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> score<span class="operator">&lt;</span><span class="number">60</span> <span class="keyword">AND</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line">WHILE <span class="variable">@noPassCount</span><span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">UPDATE</span> scores <span class="keyword">SET</span> score<span class="operator">=</span>score<span class="operator">+</span><span class="number">2</span> </span><br><span class="line">    <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@count</span><span class="operator">=</span><span class="variable">@count</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line">    PRINT <span class="string">&#x27;提分次数：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@count</span>)</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="variable">@noPassCount</span><span class="operator">=</span><span class="built_in">COUNT</span>(cId) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> score<span class="operator">&lt;</span><span class="number">60</span> <span class="keyword">AND</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@noPassCount</span> <span class="type">INT</span> ,<span class="variable">@count</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@count</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line">WHILE <span class="number">1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">UPDATE</span> scores <span class="keyword">SET</span> score<span class="operator">=</span>score<span class="operator">+</span><span class="number">2</span> </span><br><span class="line">    <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@count</span><span class="operator">=</span><span class="variable">@count</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">    PRINT <span class="string">&#x27;提分次数：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@count</span>)</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="variable">@noPassCount</span><span class="operator">=</span><span class="built_in">COUNT</span>(cId) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> score<span class="operator">&lt;</span><span class="number">60</span> <span class="keyword">AND</span> cId<span class="operator">=</span><span class="number">1</span></span><br><span class="line">    IF <span class="variable">@noPassCount</span><span class="operator">=</span><span class="number">0</span> </span><br><span class="line">        BREAK</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="comment">--根据如下规则对2号课程的考试成绩进行反复加分，直到2号课程的平均分超过85分为止。请编写T-SQL语句实现。</span></span><br><span class="line"><span class="comment">--90分以上：   不加分</span></span><br><span class="line"><span class="comment">--80－89分：   加1分</span></span><br><span class="line"><span class="comment">--70－79分：   加2分</span></span><br><span class="line"><span class="comment">--60－69分：   加3分</span></span><br><span class="line"><span class="comment">--60分以下：   加5分</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@avgScore</span> <span class="type">INT</span> ,<span class="variable">@count</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@count</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line">WHILE <span class="number">1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">UPDATE</span> scores <span class="keyword">SET</span> score<span class="operator">=</span><span class="keyword">CASE</span> <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">90</span> <span class="keyword">THEN</span> score</span><br><span class="line">                             <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">80</span> <span class="keyword">THEN</span> score<span class="operator">+</span><span class="number">1</span></span><br><span class="line">                             <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">70</span> <span class="keyword">THEN</span> score<span class="operator">+</span><span class="number">2</span></span><br><span class="line">                             <span class="keyword">WHEN</span> score<span class="operator">&gt;=</span><span class="number">60</span> <span class="keyword">THEN</span> score<span class="operator">+</span><span class="number">3</span></span><br><span class="line">                             <span class="keyword">ELSE</span> score<span class="operator">+</span><span class="number">5</span> <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@count</span><span class="operator">=</span><span class="variable">@count</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">    PRINT <span class="string">&#x27;提分次数：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@count</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="variable">@avgScore</span><span class="operator">=</span><span class="built_in">AVG</span>(score) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="number">2</span></span><br><span class="line">    IF <span class="variable">@avgScore</span><span class="operator">&gt;</span><span class="number">85</span></span><br><span class="line">        BREAK</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><h2 id="事务、索引、视图"><a href="#事务、索引、视图" class="headerlink" title="事务、索引、视图"></a>事务、索引、视图</h2><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>事务(TRANSACTION)是作为单个逻辑工作单元执行的一系列操作<br>这些操作作为一个整体一起向系统提交，要么都执行、要么都不执行<br>事务是一个不可分割的工作逻辑单元 </p>
<p><strong>显式事务</strong></p>
<ul>
<li>开启事务：BEGIN TRANSACTION</li>
<li>提交事务：COMMIT TRANSACTION</li>
<li>回滚事务：ROLLBACK TRANSACTION</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRANSACTION</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@TRANCOUNT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--COMMIT TRANSACTION</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> TRANSACTION</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@TRANCOUNT</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p><strong>使用事务解决转账</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--从张三账户转账1000到李四账户</span></span><br><span class="line"><span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">BEGIN</span> TRANSACTION  <span class="comment">--开启事务</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@sumERROR</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@sumERROR</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line"><span class="keyword">UPDATE</span> bank <span class="keyword">SET</span> currentMoney<span class="operator">-</span><span class="operator">=</span><span class="number">500</span> <span class="keyword">WHERE</span> customerName<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@sumERROR</span><span class="operator">+</span><span class="operator">=</span>@<span class="variable">@ERROR</span></span><br><span class="line"><span class="keyword">UPDATE</span> bank <span class="keyword">SET</span> currentMoney<span class="operator">+</span><span class="operator">=</span><span class="number">500</span> <span class="keyword">WHERE</span> customerName<span class="operator">=</span><span class="string">&#x27;李四&#x27;</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@sumERROR</span><span class="operator">+</span><span class="operator">=</span>@<span class="variable">@ERROR</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> bank</span><br><span class="line"></span><br><span class="line">IF <span class="variable">@sumERROR</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">COMMIT</span> TRANSACTION</span><br><span class="line">    PRINT <span class="string">&#x27;转账成功&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">ROLLBACK</span> TRANSACTION</span><br><span class="line">    PRINT <span class="string">&#x27;转账失败&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line">PRINT <span class="string">&#x27;转账之后的账户：&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> bank</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">USE StudentDB20240508</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p><strong>按照姓名创建索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX IX_sname <span class="keyword">ON</span> students(sname) <span class="keyword">WITH</span> FILLFACTOR<span class="operator">=</span><span class="number">70</span></span><br></pre></td></tr></table></figure>
<p><strong>删除索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX students.IX_sname</span><br><span class="line"></span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> NONCLUSTERED INDEX IX_sname <span class="keyword">ON</span> students(sname) <span class="keyword">WITH</span> FILLFACTOR<span class="operator">=</span><span class="number">70</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s111&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>查询时无需指定使用哪个索引，系统会自动优化查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students <span class="keyword">with</span>(INDEX<span class="operator">=</span>IX_sname)</span><br><span class="line"><span class="keyword">WHERE</span> sname<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p><strong>创建索引的注意事项：</strong></p>
<ul>
<li>表中有大量的数据</li>
<li>选择用于搜索和排序的列</li>
<li>列不能有大量重复的值</li>
</ul>
<p>优点：</p>
<ul>
<li>加强行的唯一性</li>
<li>提高 查询 速度</li>
</ul>
<p>缺点：</p>
<ul>
<li>由于索引页也需要存储 ，所以需要更多的存储空间</li>
<li>数据的操作，索引也需要调整，所以时间可能更长</li>
</ul>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>视图：筛选数据表中的数据，从一张表或多张表中获得一些综合数据<br>视图不存储数据，视图中的数据是虚拟，来自于创建视图时引用的基表的数据。</p>
<p><strong>创建视图，保存学员的学号，姓名，考试的课程名和成绩</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> VW_stu</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line">    <span class="keyword">SELECT</span> s.sno,s.sname,c.courseName,sc.score</span><br><span class="line">    <span class="keyword">FROM</span> students s <span class="keyword">INNER</span> <span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.sno<span class="operator">=</span>sc.sno </span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.cId<span class="operator">=</span>c.courseId</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p><strong>从视图中查询数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> VW_stu</span><br></pre></td></tr></table></figure>

<p><strong>更新视图，实际上是更新视图所引用的基表中的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> VW_stu <span class="keyword">SET</span> score<span class="operator">=</span><span class="number">100</span> <span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="string">&#x27;s001&#x27;</span> <span class="keyword">AND</span> courseName<span class="operator">=</span><span class="string">&#x27;C#&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>视图中的数据不能删除</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> VW_stu</span><br></pre></td></tr></table></figure>

<p><strong>删除视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> VW_stu</span><br></pre></td></tr></table></figure>

<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>存储过程可以将对数据库的一些业务规则统一保存在存储过程中，可以包含对数据库的各种操作，也可以包含数据库编程语句。<br>优点</p>
<ul>
<li>复用代码，实现代码的模块化设计</li>
<li>执行速度更快</li>
<li>降低网络的流量</li>
<li>代码安全性更高</li>
</ul>
<p>存储过程分为</p>
<ul>
<li>系统存储过程：由系统定义的存储过程，保存在master数据库中</li>
<li>自定义存储过程：由用户根据业务需求自定义的存储过程</li>
</ul>
<h3 id="系统存储过程"><a href="#系统存储过程" class="headerlink" title="系统存储过程"></a>系统存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> sp_databases    <span class="comment">--列出所有的数据库</span></span><br><span class="line"><span class="keyword">EXEC</span> sp_helptext <span class="variable">@objname</span><span class="operator">=</span><span class="string">&#x27;sp_help&#x27;</span>  <span class="comment">--显示创建存储过程的文本</span></span><br><span class="line"><span class="keyword">EXEC</span> sp_tables <span class="variable">@table_name</span><span class="operator">=</span><span class="string">&#x27;Employee&#x27;</span>   <span class="comment">--列出当前环境下可查询的对象列表</span></span><br><span class="line"><span class="keyword">EXEC</span> sp_renamedb <span class="variable">@dbname</span><span class="operator">=</span><span class="string">&#x27;BankDB&#x27;</span>,<span class="variable">@newname</span><span class="operator">=</span><span class="string">&#x27;BandDB1&#x27;</span> <span class="comment">--修改数据库名称</span></span><br><span class="line"><span class="keyword">EXEC</span> sp_password <span class="variable">@new</span><span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>,<span class="variable">@loginame</span><span class="operator">=</span><span class="string">&#x27;sa&#x27;</span>  <span class="comment">--修改登录账号的密码</span></span><br><span class="line"><span class="keyword">EXEC</span> sp_help <span class="variable">@objname</span><span class="operator">=</span><span class="string">&#x27;Scores&#x27;</span>  <span class="comment">--列出指定对象的帮助信息</span></span><br><span class="line"><span class="keyword">EXEC</span> sp_stored_procedures   <span class="comment">--列出当前环境下的可用存储过程</span></span><br></pre></td></tr></table></figure>

<h3 id="自定义存储过程"><a href="#自定义存储过程" class="headerlink" title="自定义存储过程"></a>自定义存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> scores2</span><br><span class="line">(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    sno <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,   </span><br><span class="line">    writtenExam <span class="type">int</span>,</span><br><span class="line">    labExam <span class="type">int</span></span><br><span class="line">)</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> scores2</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> scores2</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;s001&#x27;</span>,<span class="number">58</span>,<span class="number">92</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;s002&#x27;</span>,<span class="number">74</span>,<span class="number">51</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;s003&#x27;</span>,<span class="number">64</span>,<span class="number">78</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;s004&#x27;</span>,<span class="number">55</span>,<span class="number">79</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;s005&#x27;</span>,<span class="number">69</span>,<span class="number">56</span> </span><br><span class="line"></span><br><span class="line">GO</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores2</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<h3 id="无参的存储过程"><a href="#无参的存储过程" class="headerlink" title="无参的存储过程"></a>无参的存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">创建存储过程，查看考试的平均分，以及未通过考试的信息</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> proc_getavg</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(writtenExam) <span class="keyword">FROM</span> scores2 </span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span>  <span class="keyword">FROM</span> scores2 <span class="keyword">WHERE</span> writtenExam<span class="operator">&lt;</span><span class="number">60</span></span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="comment">--调用存储过程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> proc_getavg</span><br><span class="line">GO</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="带有输入参数的存储过程"><a href="#带有输入参数的存储过程" class="headerlink" title="带有输入参数的存储过程"></a>带有输入参数的存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> proc_getavg2</span><br><span class="line"><span class="variable">@courseId</span> <span class="type">INT</span>  <span class="comment">--输入参数</span></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    PRINT <span class="string">&#x27;考试平均分：&#x27;</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(score) <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> cId<span class="operator">=</span><span class="variable">@courseId</span></span><br><span class="line"></span><br><span class="line">    PRINT <span class="string">&#x27;未通过考试的成绩信息：&#x27;</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores <span class="keyword">WHERE</span> score<span class="operator">&lt;</span><span class="number">60</span> <span class="keyword">AND</span> cId<span class="operator">=</span><span class="variable">@courseId</span></span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> proc_getavg2 <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> proc_getavg2 <span class="variable">@courseId</span><span class="operator">=</span><span class="number">2</span></span><br><span class="line">GO</span><br><span class="line"><span class="comment">--根据考试的验易程度，设置不同的考试及格线，查询所有未通过考试的成绩信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> proc_getnopassscores</span><br><span class="line"><span class="variable">@writtenExam</span> <span class="type">int</span>,  <span class="comment">--笔试及格线</span></span><br><span class="line"><span class="variable">@labExam</span> <span class="type">int</span>  <span class="comment">--机试及格线</span></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    PRINT <span class="string">&#x27;笔试及格线：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@writtenExam</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;机试及格线：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@labExam</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;未通过成绩信息：&#x27;</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores2 <span class="keyword">WHERE</span> writtenExam<span class="operator">&lt;</span><span class="variable">@writtenExam</span> <span class="keyword">OR</span> labExam<span class="operator">&lt;</span><span class="variable">@labExam</span>    </span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> proc_getnopassscores <span class="variable">@writtenExam</span><span class="operator">=</span><span class="number">60</span>,<span class="variable">@labExam</span><span class="operator">=</span><span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> proc_getnopassscores <span class="variable">@writtenExam</span><span class="operator">=</span><span class="number">56</span>,<span class="variable">@labExam</span><span class="operator">=</span><span class="number">55</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建存储过程，统计指定年和月的工资报表</span></span><br><span class="line"></span><br><span class="line">USE CompanyDB</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> PROC_GETSalary</span><br><span class="line"><span class="variable">@year</span> <span class="type">INT</span>,<span class="comment">--年</span></span><br><span class="line"><span class="variable">@month</span> <span class="type">INT</span> <span class="comment">--月</span></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@i</span> <span class="type">INT</span>,<span class="variable">@count</span> <span class="type">INT</span>,<span class="variable">@sumAbsenceMoney</span> money, <span class="variable">@salary</span> money</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@i</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@count</span><span class="operator">=</span><span class="built_in">MAX</span>(EmpID) <span class="keyword">FROM</span> Employee</span><br><span class="line">WHILE(<span class="variable">@i</span><span class="operator">&lt;=</span><span class="variable">@count</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@sumAbsenceMoney</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line">    IF <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Employee <span class="keyword">WHERE</span> EmpID<span class="operator">=</span><span class="variable">@i</span>)</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">--查询基本工资</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="variable">@salary</span><span class="operator">=</span>Salary <span class="keyword">FROM</span> Employee <span class="keyword">WHERE</span> EmpID<span class="operator">=</span><span class="variable">@i</span></span><br><span class="line">        <span class="comment">--查询请假扣除的工资</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="variable">@sumAbsenceMoney</span><span class="operator">=</span>ISNULL(<span class="built_in">SUM</span>(at.AbMoney),<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">FROM</span> Absence a <span class="keyword">inner</span> <span class="keyword">join</span> AbsenceType <span class="keyword">at</span> <span class="keyword">on</span> a.AbsenceTypeID<span class="operator">=</span>at.AbsenceTypeID</span><br><span class="line">        <span class="keyword">WHERE</span> a.EmpID<span class="operator">=</span><span class="variable">@i</span> <span class="keyword">AND</span> DATEPART(<span class="keyword">YEAR</span>,a.AbsenceDate)<span class="operator">=</span><span class="variable">@year</span> <span class="keyword">AND</span> DATEPART(<span class="keyword">MONTH</span>,a.AbsenceDate)<span class="operator">=</span><span class="variable">@month</span>     </span><br><span class="line">        IF <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sysobjects <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;salaryTbl&#x27;</span>)</span><br><span class="line">        <span class="keyword">BEGIN</span></span><br><span class="line">            PRINT <span class="string">&#x27;工资表已存在&#x27;</span></span><br><span class="line">            <span class="keyword">INSERT</span> <span class="keyword">INTO</span> salaryTbl</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="variable">@year</span>,<span class="variable">@month</span>,<span class="variable">@salary</span><span class="operator">-</span><span class="variable">@sumAbsenceMoney</span>,<span class="variable">@i</span></span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line">        <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">BEGIN</span></span><br><span class="line">            PRINT <span class="string">&#x27;工资表不存在&#x27;</span></span><br><span class="line">            <span class="keyword">SELECT</span> SalID<span class="operator">=</span><span class="keyword">IDENTITY</span>(<span class="type">INT</span>,<span class="number">1</span>,<span class="number">1</span>),SalYear<span class="operator">=</span><span class="variable">@year</span>,SalMonth<span class="operator">=</span><span class="variable">@month</span>,SalMoney<span class="operator">=</span><span class="variable">@salary</span><span class="operator">-</span><span class="variable">@sumAbsenceMoney</span>,FEmpID<span class="operator">=</span><span class="variable">@i</span></span><br><span class="line">            <span class="keyword">INTO</span> salaryTbl          </span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line">        PRINT <span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@i</span>)<span class="operator">+</span><span class="string">&#x27;号工资已生成&#x27;</span>      </span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@i</span><span class="operator">=</span><span class="variable">@i</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">GO</span><br><span class="line"><span class="keyword">EXEC</span> PROC_GETSalary <span class="variable">@year</span><span class="operator">=</span><span class="number">2011</span>,<span class="variable">@month</span><span class="operator">=</span><span class="number">9</span></span><br><span class="line"><span class="keyword">EXEC</span> PROC_GETSalary <span class="variable">@year</span><span class="operator">=</span><span class="number">2012</span>,<span class="variable">@month</span><span class="operator">=</span><span class="number">5</span></span><br><span class="line"><span class="keyword">EXEC</span> PROC_GETSalary <span class="variable">@year</span><span class="operator">=</span><span class="number">2019</span>,<span class="variable">@month</span><span class="operator">=</span><span class="number">10</span></span><br><span class="line"><span class="keyword">EXEC</span> PROC_GETSalary <span class="number">2011</span>,<span class="number">9</span></span><br><span class="line"><span class="keyword">EXEC</span> PROC_GETSalary <span class="variable">@month</span><span class="operator">=</span><span class="number">5</span>,<span class="variable">@year</span><span class="operator">=</span><span class="number">2012</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> [salaryTbl]</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [salaryTbl]</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> [dbo].[salaryTbl]</span><br><span class="line">GO</span><br><span class="line">USE StudentDB20240508</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<h3 id="设置输入参数的默认值"><a href="#设置输入参数的默认值" class="headerlink" title="设置输入参数的默认值"></a>设置输入参数的默认值</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--考试的及格线一般都是60，如果没有指定则使用60分作为考试及格线</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> proc_getnopassscores2</span><br><span class="line"><span class="variable">@writtenExam</span> <span class="type">int</span><span class="operator">=</span><span class="number">60</span>,  <span class="comment">--笔试及格线</span></span><br><span class="line"><span class="variable">@labExam</span> <span class="type">int</span><span class="operator">=</span><span class="number">60</span>  <span class="comment">--机试及格线</span></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    PRINT <span class="string">&#x27;笔试及格线：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@writtenExam</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;机试及格线：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@labExam</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;未通过成绩信息：&#x27;</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores2 <span class="keyword">WHERE</span> writtenExam<span class="operator">&lt;</span><span class="variable">@writtenExam</span> <span class="keyword">OR</span> labExam<span class="operator">&lt;</span><span class="variable">@labExam</span>    </span><br><span class="line">GO</span><br><span class="line"><span class="keyword">EXEC</span> proc_getnopassscores2  <span class="comment">--都使用默认值</span></span><br><span class="line"><span class="keyword">EXEC</span> proc_getnopassscores2 <span class="variable">@labExam</span><span class="operator">=</span><span class="number">55</span> <span class="comment">--笔试默认值，机试提供 值</span></span><br><span class="line"><span class="keyword">EXEC</span> proc_getnopassscores2 <span class="variable">@writtenExam</span><span class="operator">=</span><span class="number">56</span> <span class="comment">--笔试提供 值，机试默认值</span></span><br><span class="line"><span class="keyword">EXEC</span> proc_getnopassscores2 <span class="number">55</span></span><br></pre></td></tr></table></figure>

<h3 id="带有输出参数的存储过程"><a href="#带有输出参数的存储过程" class="headerlink" title="带有输出参数的存储过程"></a>带有输出参数的存储过程</h3><p><strong>根据指定的及格线，查询出未通过考试的信息，以及人数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> proc_getnopassscores3</span><br><span class="line"><span class="variable">@noPassCount</span> <span class="type">int</span> output, <span class="comment">--输出 参数</span></span><br><span class="line"><span class="variable">@writtenExam</span> <span class="type">int</span><span class="operator">=</span><span class="number">60</span>,  <span class="comment">--笔试及格线</span></span><br><span class="line"><span class="variable">@labExam</span> <span class="type">int</span><span class="operator">=</span><span class="number">60</span>  <span class="comment">--机试及格线</span></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span></span><br><span class="line">    PRINT <span class="string">&#x27;笔试及格线：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@writtenExam</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;机试及格线：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@labExam</span>)</span><br><span class="line">    PRINT <span class="string">&#x27;未通过成绩信息：&#x27;</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> scores2 <span class="keyword">WHERE</span> writtenExam<span class="operator">&lt;</span><span class="variable">@writtenExam</span> <span class="keyword">OR</span> labExam<span class="operator">&lt;</span><span class="variable">@labExam</span>    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="variable">@noPassCount</span><span class="operator">=</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> scores2 <span class="keyword">WHERE</span> writtenExam<span class="operator">&lt;</span><span class="variable">@writtenExam</span> <span class="keyword">OR</span> labExam<span class="operator">&lt;</span><span class="variable">@labExam</span>    </span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p><strong>声明变量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@count</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">EXEC</span> proc_getnopassscores3 <span class="variable">@noPassCount</span><span class="operator">=</span><span class="variable">@count</span> output,<span class="variable">@writtenExam</span><span class="operator">=</span><span class="number">56</span></span><br><span class="line">PRINT <span class="string">&#x27;未通过考试的人数是：&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>), <span class="variable">@count</span>)</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">USE StudentDB20240508</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">DROP</span> PROC proc_addStudent</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p><strong>综合案例：创建存储过程，实现新增学员信息，需要判断学号不能重复，班级编号需要存在</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> proc_addStudent</span><br><span class="line"><span class="variable">@message</span> <span class="type">varchar</span>(<span class="number">100</span>) output,</span><br><span class="line"><span class="variable">@sno</span> <span class="type">varchar</span>(<span class="number">10</span>),<span class="comment">--学号</span></span><br><span class="line"><span class="variable">@sname</span> nvarchar(<span class="number">10</span>),<span class="comment">--姓名</span></span><br><span class="line"><span class="variable">@sex</span> bit, <span class="comment">--性别</span></span><br><span class="line"><span class="variable">@classId</span> <span class="type">int</span>, <span class="comment">--班级编号</span></span><br><span class="line"><span class="variable">@birthday</span> <span class="type">date</span><span class="operator">=</span><span class="keyword">null</span>,<span class="comment">--出生日期</span></span><br><span class="line"><span class="variable">@phoneNo</span> <span class="type">char</span>(<span class="number">11</span>)<span class="operator">=</span><span class="keyword">null</span>,<span class="comment">--手机号码</span></span><br><span class="line"><span class="variable">@email</span> <span class="type">varchar</span>(<span class="number">50</span>)<span class="operator">=</span><span class="keyword">null</span>, <span class="comment">--邮箱</span></span><br><span class="line"><span class="variable">@personId</span> <span class="type">char</span>(<span class="number">18</span>)<span class="operator">=</span><span class="keyword">null</span><span class="comment">--身份证</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">    <span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span></span><br><span class="line">    <span class="comment">--学号不能重复</span></span><br><span class="line">    IF <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> [dbo].[students] <span class="keyword">WHERE</span> sno<span class="operator">=</span><span class="variable">@sno</span>)</span><br><span class="line">        <span class="keyword">SET</span> <span class="variable">@message</span><span class="operator">=</span><span class="string">&#x27;学号&#x27;</span><span class="operator">+</span><span class="variable">@sno</span><span class="operator">+</span><span class="string">&#x27;已存在！&#x27;</span></span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">--班级编号需要存在</span></span><br><span class="line">        IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> classes <span class="keyword">WHERE</span> [classId]<span class="operator">=</span><span class="variable">@classId</span>)</span><br><span class="line">            <span class="keyword">SET</span> <span class="variable">@message</span><span class="operator">=</span><span class="string">&#x27;班级编号&#x27;</span><span class="operator">+</span><span class="keyword">CONVERT</span>(<span class="type">VARCHAR</span>(<span class="number">10</span>),<span class="variable">@classId</span>)<span class="operator">+</span><span class="string">&#x27;不存在，无法添加学员！&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">BEGIN</span></span><br><span class="line">            <span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(sno,sname,sex,birthday,phoneNo,email,personID,classId)</span><br><span class="line">            <span class="keyword">VALUES</span>(<span class="variable">@sno</span>,<span class="variable">@sname</span>,<span class="variable">@sex</span>,<span class="variable">@birthday</span>,<span class="variable">@phoneNo</span>,<span class="variable">@email</span>,<span class="variable">@personId</span>,<span class="variable">@classId</span>)</span><br><span class="line">            IF @<span class="variable">@ROWCOUNT</span><span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">                <span class="keyword">SET</span> <span class="variable">@message</span><span class="operator">=</span><span class="string">&#x27;新增学员信息成功！&#x27;</span></span><br><span class="line">            <span class="keyword">ELSE</span></span><br><span class="line">                <span class="keyword">SET</span> <span class="variable">@message</span><span class="operator">=</span><span class="string">&#x27;新增学员信息失败！&#x27;</span></span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@msg</span> <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line"><span class="comment">--EXEC proc_addStudent @message=@msg output,@sno=&#x27;s009&#x27;,@sname=&#x27;TEST01&#x27;,@sex=1,@classId=1</span></span><br><span class="line"><span class="keyword">EXEC</span> proc_addStudent <span class="variable">@message</span><span class="operator">=</span><span class="variable">@msg</span> output,<span class="variable">@sno</span><span class="operator">=</span><span class="string">&#x27;s010&#x27;</span>,<span class="variable">@sname</span><span class="operator">=</span><span class="string">&#x27;TEST02&#x27;</span>,<span class="variable">@sex</span><span class="operator">=</span><span class="number">0</span>,</span><br><span class="line"><span class="variable">@classId</span><span class="operator">=</span><span class="number">2</span>,<span class="variable">@birthday</span><span class="operator">=</span><span class="string">&#x27;1994-5-8&#x27;</span>,<span class="variable">@phoneNo</span><span class="operator">=</span><span class="string">&#x27;15856859685&#x27;</span>,<span class="variable">@email</span><span class="operator">=</span><span class="string">&#x27;TEST02@163.com&#x27;</span>,<span class="variable">@personId</span><span class="operator">=</span><span class="string">&#x27;125632525785856965&#x27;</span></span><br><span class="line">PRINT <span class="variable">@msg</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>


<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器是一种特殊的存储过程，它主要在表之间制定一些业务规则，并具备事务模型<br>触发器是在对表进行插入、更新或删除操作时自动执行的存储过程</p>
<h3 id="触发器类型"><a href="#触发器类型" class="headerlink" title="触发器类型"></a>触发器类型</h3><ul>
<li><p><strong>After触发器</strong></p>
<ul>
<li><p>只能定义在数据表上</p>
</li>
<li><p>对表执行操作之后触发的触发器</p>
</li>
<li><p>对于表的同一个操作只能有一个触发器</p>
</li>
</ul>
</li>
<li><p><strong>instead of触发器</strong></p>
<ul>
<li>定义在数据表上或视图上</li>
<li>不执行预定义的操作，只触发触发器，执行触发器中的代码</li>
<li>对于同一个操作可以有多个触发器</li>
</ul>
</li>
</ul>
<p>触发器触发后，在内存在会生成两张临时表，inserted表和deleted表</p>
<ul>
<li>insert:inserted表中保存新增的数据</li>
<li>delete:deleted表中保存删除的数据</li>
<li>update:更新之前的数据保存在deleted表，更新之后的数据保存在inserted表中</li>
</ul>
<h3 id="After触发器"><a href="#After触发器" class="headerlink" title="After触发器"></a>After触发器</h3><p><strong>insert触发器</strong><br>当成功插入一条交易信息时，要自动更新对应的账户余额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trig_insert_transInfo</span><br><span class="line"><span class="keyword">on</span> TransInfo</span><br><span class="line"><span class="keyword">with</span> encryption  <span class="comment">--加密文本</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">insert</span> </span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">    <span class="keyword">set</span> nocount <span class="keyword">on</span></span><br><span class="line">    print <span class="string">&#x27;insert触发器触发&#x27;</span></span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@cardID</span> <span class="type">varchar</span>(<span class="number">10</span>),<span class="variable">@transType</span> <span class="type">varchar</span>(<span class="number">10</span>),<span class="variable">@transMoney</span> money</span><br><span class="line">    <span class="keyword">select</span>  <span class="variable">@cardID</span><span class="operator">=</span>cardID,<span class="variable">@transType</span><span class="operator">=</span>transType,<span class="variable">@transMoney</span><span class="operator">=</span>transMoney  <span class="keyword">from</span> inserted  <span class="comment">--从临时表中查询新增的数据</span></span><br><span class="line">    if <span class="variable">@transType</span><span class="operator">=</span><span class="string">&#x27;支取&#x27;</span></span><br><span class="line">        <span class="keyword">update</span> bank <span class="keyword">set</span> currentMoney<span class="operator">=</span>currentMoney<span class="operator">-</span><span class="variable">@transMoney</span> <span class="keyword">where</span> cardID<span class="operator">=</span><span class="variable">@cardID</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">update</span> bank <span class="keyword">set</span> currentMoney<span class="operator">=</span>currentMoney<span class="operator">+</span><span class="variable">@transMoney</span> <span class="keyword">where</span> cardID<span class="operator">=</span><span class="variable">@cardID</span></span><br><span class="line"></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> trig_insert_transInfo</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> nocount <span class="keyword">on</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> TransInfo(transDate,cardID,transType,transMoney) <span class="keyword">values</span>(getdate(),<span class="string">&#x27;10010001&#x27;</span>,<span class="string">&#x27;支取&#x27;</span>,<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> TransInfo(transDate,cardID,transType,transMoney) <span class="keyword">values</span>(getdate(),<span class="string">&#x27;10010001&#x27;</span>,<span class="string">&#x27;存款&#x27;</span>,<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">exec</span> sp_helptext <span class="variable">@objname</span><span class="operator">=</span><span class="string">&#x27;trig_insert_transInfo&#x27;</span></span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<p><strong>delete触发器</strong><br>删除交易记录时，将其备份到交易记录备份表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trig_delete_transInfo</span><br><span class="line"><span class="keyword">on</span> TransInfo</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">delete</span> </span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">    <span class="keyword">set</span> nocount <span class="keyword">on</span></span><br><span class="line">    print <span class="string">&#x27;正在备份...&#x27;</span></span><br><span class="line">    if <span class="keyword">not</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;transInfo2&#x27;</span>)</span><br><span class="line">        <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">into</span> transInfo2 <span class="keyword">from</span> deleted</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> transInfo2</span><br><span class="line">        <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> deleted</span><br><span class="line">    print <span class="string">&#x27;备份成功&#x27;</span></span><br><span class="line"></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> trig_delete_transInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> TransInfo <span class="keyword">where</span> transDate<span class="operator">=</span><span class="string">&#x27;2024-05-14 15:27:10.273&#x27;</span></span><br><span class="line"><span class="comment">--触发delete触发器</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> TransInfo</span><br><span class="line"></span><br><span class="line"><span class="comment">--不触发delete触发器</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> TransInfo</span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<p><strong>update触发器</strong><br>跟踪用户的交易，交易金额超过20000元，则取消交易，并给出错误提示。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trig_update_bank</span><br><span class="line"><span class="keyword">on</span> bank</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">update</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">    <span class="keyword">set</span> nocount <span class="keyword">on</span></span><br><span class="line">    print <span class="string">&#x27;update触发器触发&#x27;</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> bank</span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@beforeMoney</span> money,<span class="variable">@afterMoney</span> money</span><br><span class="line">    <span class="keyword">select</span> <span class="variable">@beforeMoney</span><span class="operator">=</span>currentMoney <span class="keyword">from</span> deleted</span><br><span class="line">    <span class="keyword">select</span> <span class="variable">@afterMoney</span><span class="operator">=</span>currentMoney <span class="keyword">from</span> inserted</span><br><span class="line"></span><br><span class="line">    if <span class="built_in">ABS</span>(<span class="variable">@afterMoney</span><span class="operator">-</span><span class="variable">@beforeMoney</span>)<span class="operator">&gt;</span><span class="number">20000</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        print <span class="string">&#x27;单笔交易金额不能超过20000元&#x27;</span></span><br><span class="line">        <span class="keyword">rollback</span> transaction</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> trig_update_bank</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> bank <span class="keyword">set</span> currentMoney<span class="operator">+</span><span class="operator">=</span><span class="number">25000</span> <span class="keyword">where</span> cardID<span class="operator">=</span><span class="string">&#x27;10010001&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> TransInfo(transDate,cardID,transType,transMoney) <span class="keyword">values</span>(getdate(),<span class="string">&#x27;10010001&#x27;</span>,<span class="string">&#x27;存款&#x27;</span>,<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<h3 id="instead-of触发器"><a href="#instead-of触发器" class="headerlink" title="instead of触发器"></a>instead of触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trig_update_insteadof_bank</span><br><span class="line"><span class="keyword">on</span> bank</span><br><span class="line">instead <span class="keyword">of</span> <span class="keyword">update</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">    print <span class="string">&#x27;instead of 触发器触发&#x27;</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> bank</span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@beforeMoney</span> money,<span class="variable">@afterMoney</span> money,<span class="variable">@cardID</span> <span class="type">varchar</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">select</span> <span class="variable">@beforeMoney</span><span class="operator">=</span>currentMoney,<span class="variable">@cardID</span><span class="operator">=</span>cardID <span class="keyword">from</span> deleted</span><br><span class="line">    <span class="keyword">select</span> <span class="variable">@afterMoney</span><span class="operator">=</span>currentMoney <span class="keyword">from</span> inserted</span><br><span class="line"></span><br><span class="line">    if <span class="built_in">ABS</span>(<span class="variable">@afterMoney</span><span class="operator">-</span><span class="variable">@beforeMoney</span>)<span class="operator">&lt;=</span><span class="number">20000</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        print <span class="string">&#x27;账户更新成功&#x27;</span></span><br><span class="line">        <span class="keyword">update</span> bank <span class="keyword">set</span> currentMoney<span class="operator">=</span><span class="variable">@afterMoney</span> <span class="keyword">where</span> cardID<span class="operator">=</span><span class="variable">@cardID</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> trig_update_insteadof_bank</span><br><span class="line"><span class="keyword">update</span> bank <span class="keyword">set</span> currentMoney<span class="operator">+</span><span class="operator">=</span><span class="number">1000</span> <span class="keyword">where</span> cardID<span class="operator">=</span><span class="string">&#x27;10010001&#x27;</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/sqlserver/" rel="tag"># sqlserver</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Linq/" rel="prev" title="Linq">
                  <i class="fa fa-angle-left"></i> Linq
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/ADO.NET/" rel="next" title="ADO.NET">
                  ADO.NET <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
